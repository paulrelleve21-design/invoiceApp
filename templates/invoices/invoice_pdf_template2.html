<!DOCTYPE html>
{% load tz %}
<html>
<head>
    <meta charset="UTF-8">
    <style>
        @page { size: A4; margin: 2cm; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 11pt; color: #1f2937; }
        .header { margin-bottom: 18px; border-bottom: 3px solid #10b981; padding-bottom: 8px; }
        .company-info { float: left; width: 60%; }
        .invoice-info { float: right; width: 35%; text-align: right; background:#f0fdf4; padding:8px; border-radius:6px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        table th { background-color: #ecfdf5; padding: 10px; text-align: left; border-bottom: 1px solid #d1fae5; font-weight:700; }
        table td { padding:8px; border-bottom:1px solid #f1f5f9; }
        .totals { float:right; width:40%; margin-top:12px; }
        .total-row { font-weight:700; font-size:13pt; }
        .footer { margin-top:30px; text-align:center; color:#6b7280; }
    </style>
</head>
<body>
    {% if invoice and business %}
    <div class="header clearfix" style="padding-bottom:6px; border-bottom:1px solid #d1fae5;">
        <div class="company-info">
            {% if business.logo %}
                <img src="{{ business.logo.url }}" style="max-width: 120px; max-height: 60px;" alt="Company Logo">
            {% endif %}
            <h2 style="margin:6px 0 6px 0; font-size:1.15rem;">{{ business.business_name }}</h2>
            <p style="margin:0;color:#374151;">{{ business.address }}{% if business.email %}<br>{{ business.email }}{% endif %}{% if business.phone %} | {{ business.phone }}{% endif %}</p>
        </div>
        <div class="invoice-info" style="background:transparent;padding:0;">
            <div style="text-align:right; padding:6px;">
                <div style="font-weight:700; font-size:1.1rem;">INVOICE</div>
                <div style="margin-top:4px;">#{{ invoice.invoice_number }}</div>
                <div style="font-size:12px; color:#6b7280;">{{ invoice.invoice_date }}</div>
            </div>
        </div>
    </div>
    {% else %}
    <div style="padding:18px; border:1px solid #e6e6e6; border-radius:6px; background:#fffbeb;">No preview data</div>
    {% endif %}

    <div class="client-info" style="margin:12px 0;">
        <strong>Bill To:</strong><br>
        <p style="margin:6px 0 0 0;">{% if invoice.client_name %}{{ invoice.client_name }}{% else %}{{ invoice.client.name }}{% endif %}</p>
    </div>

    <table>
        <thead>
            <tr><th>Description</th><th style="width:12%;text-align:right;">Qty</th><th style="width:20%;text-align:right;">Unit</th><th style="width:20%;text-align:right;">Total</th></tr>
        </thead>
        <tbody>
            {% if invoice and invoice.items.exists %}
                {% for item in invoice.items.all %}
                <tr>
                    <td>{{ item.description }}</td>
                    <td style="text-align:right;">{{ item.quantity }}</td>
                    <td style="text-align:right;">{{ invoice.currency }} {{ item.unit_price }}</td>
                    <td style="text-align:right;">{{ invoice.currency }} {{ item.line_total }}</td>
                </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="4" style="text-align:center;padding:20px;color:#9ca3af;">No items</td></tr>
            {% endif %}
        </tbody>
    </table>

    <div class="totals">
        <table>
            <tr><td>Subtotal:</td><td style="text-align:right;">{{ invoice.currency }} {{ invoice.subtotal }}</td></tr>
            <tr><td>Tax:</td><td style="text-align:right;">{{ invoice.currency }} {{ invoice.tax_amount }}</td></tr>
            <tr class="total-row"><td>Total:</td><td style="text-align:right;">{{ invoice.currency }} {{ invoice.total_amount }}</td></tr>
        </table>
    </div>

    <div style="clear:both;"></div>

    <div class="footer">Template 2 â€” Fresh (green accents)</div>
</body>
</html>
