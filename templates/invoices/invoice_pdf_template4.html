<!DOCTYPE html>
{% load tz %}
<html>
<head>
    <meta charset="UTF-8">
    <style>
        @page { size: A4; margin: 2cm; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; color:#0f172a; font-size:11pt; }
        .topbar { background: linear-gradient(90deg,#0ea5e9,#3b82f6); padding:14px 18px; color: white; border-radius:6px 6px 0 0; }
        .company { float:left; }
        .invoice-meta { float:right; text-align:right; }
        .company h2 { margin:0; }
        .client { margin-top:22px; }
        table { width:100%; border-collapse:collapse; margin-top:14px; }
        th, td { padding:10px; border-bottom:1px solid #e6eefc; }
        th { background:#f1f9ff; text-align:left; }
        .totals { float:right; width:38%; margin-top:12px; }
        .footer { clear:both; margin-top:36px; color:#6b7280; text-align:center; }
        /* Responsive adjustments for narrow preview container */
        @media(max-width:480px){
            .company, .invoice-meta { float:none !important; width:100% !important; text-align:left !important; }
            .topbar { padding:10px; }
            table th, table td { padding:6px; font-size:10pt; }
            .totals { float:none !important; width:100% !important; margin-top:8px !important; }
        }
    </style>
</head>
<body>
    {% if invoice and business %}
    <div class="topbar clearfix">
        <div class="company">
            {% if business.logo %}
                <img src="{{ business.logo.url }}" style="max-width:120px; max-height:70px; display:inline-block; vertical-align:middle; margin-right:10px;" alt="Logo">
            {% endif %}
            <span style="font-weight:700; font-size:1.05rem; vertical-align:middle;">{{ business.business_name }}</span>
        </div>
        <div class="invoice-meta">
            <div style="font-weight:700; font-size:1.2rem;">INVOICE</div>
            <div>#{{ invoice.invoice_number }}</div>
            <div style="font-size:12px;">{{ invoice.invoice_date }}</div>
        </div>
    </div>
    {% endif %}

    <div class="client">
        <strong>Bill To:</strong><br>
        <div style="margin-top:6px;">{% if invoice.client_name %}{{ invoice.client_name }}{% else %}{{ invoice.client.name }}{% endif %}</div>
        {% if invoice.client_address %}<div style="color:#475569; margin-top:4px;">{{ invoice.client_address }}</div>{% endif %}
    </div>

    <table>
        <thead>
            <tr><th>Description</th><th style="width:12%;text-align:right;">Qty</th><th style="width:20%;text-align:right;">Unit</th><th style="width:20%;text-align:right;">Total</th></tr>
        </thead>
        <tbody>
            {% if invoice and invoice.items.exists %}
                {% for item in invoice.items.all %}
                <tr>
                    <td>{{ item.description }}</td>
                    <td style="text-align:right;">{{ item.quantity }}</td>
                    <td style="text-align:right;">{{ invoice.currency }} {{ item.unit_price }}</td>
                    <td style="text-align:right;">{{ invoice.currency }} {{ item.line_total }}</td>
                </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="4" style="text-align:center;padding:20px;color:#9ca3af;">No items</td></tr>
            {% endif %}
        </tbody>
    </table>

    <div class="totals">
        <table>
            <tr><td>Subtotal:</td><td style="text-align:right;">{{ invoice.currency }} {{ invoice.subtotal }}</td></tr>
            <tr><td>Tax:</td><td style="text-align:right;">{{ invoice.currency }} {{ invoice.tax_amount }}</td></tr>
            <tr style="font-weight:700;"><td>Total:</td><td style="text-align:right;">{{ invoice.currency }} {{ invoice.total_amount }}</td></tr>
        </table>
    </div>

    <div style="clear:both;"></div>
    <div class="footer">Template 4 â€” Modern Blue</div>
</body>
</html>
